#!/usr/bin/env bash
set -euo pipefail

cd "$(git rev-parse --show-toplevel)"

source scripts/include/build-env
scripts/build-cdk > /dev/null

docker run --interactive \
           --tty \
           --rm \
           --env AWS_ACCESS_KEY_ID \
           --env AWS_SECRET_ACCESS_KEY \
           --env AWS_ACCOUNT \
           --env AWS_SECURITY_TOKEN \
           --env AWS_DEFAULT_REGION \
           --mount=type=bind,source="${DOCKER_SOCKET}",target="${DOCKER_SOCKET}",relabel=private \
           --mount=type=bind,source="$(pwd)"/,target="$(pwd)",relabel=private \
           --workdir "$(pwd)" \
           "${APP_NAME}/cdk:latest" \
           "$@"
