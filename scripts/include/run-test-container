#!/usr/bin/env bash
set -euo pipefail

cd "$(git rev-parse --show-toplevel)"

source scripts/include/build-env
scripts/build-test

docker run --interactive \
           --tty \
           --rm \
           -e AWS_ACCESS_KEY_ID=${AWS_ACCESS_KEY_ID:-$AWS_DEFAULT_ACCESS_KEY} \
           -e AWS_SECRET_ACCESS_KEY=${AWS_SECRET_ACCESS_KEY:-$AWS_DEFAULT_SECRET_KEY} \
           -e AWS_DEFAULT_REGION=${AWS_DEFAULT_REGION} \
           --mount=type=bind,source="$(pwd)"/,target=${CODE_DIR} \
           --workdir ${CODE_DIR} \
           ${APP_NAME}/test:latest \
           "$@"
